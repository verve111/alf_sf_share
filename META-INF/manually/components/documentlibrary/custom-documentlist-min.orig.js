(function(){var f=YAHOO.util.Dom;var c=Alfresco.util.encodeHTML,d=Alfresco.util.combinePaths,e=Alfresco.util.siteURL,a=Alfresco.util.isValueSet;beCPG.custom.DocumentList=function b(m){beCPG.custom.DocumentList.superclass.constructor.call(this,m);YAHOO.Bubbling.on("doclistMetadata",this.onDoclistMetadata,this);return this};YAHOO.extend(beCPG.custom.DocumentList,Alfresco.DocumentList,{onDoclistMetadata:function(q,o){var p=o[1].metadata,r=this;if(p!==null&&beCPG.util.isEntity(p.parent)){var t=f.get(r.id+"-becpg-entityFolder-message"),n=p.parent.type.split(":")[1],m;var s="product";if(n=="rawMaterial"||n=="finishedProduct"||n=="semiFinishedProduct"||n=="localSemiFinishedProduct"||n=="packagingKit"||n=="packagingMaterial"||n=="resourceProduct"){s="product"}else{if(n=="projet"||n=="systemEntity"||n=="aclGroup"||n=="entityTplFolder"){s=n}else{s="entity"}}m="<img  src='"+Alfresco.constants.PROXY_URI+"/api/node/"+p.parent.nodeRef.replace(":/","")+"/content/thumbnails/doclib?c=queue&ph=true' class='node-thumbnail' width='48'>";m+="<span >"+Alfresco.util.message("page.documentlibrary.instructions."+s)+"</span>";t.innerHTML=m;this.widgets.viewEntityLists=Alfresco.util.createYUIButton(r,"viewEntityLists-button",function(w,v,u){window.location.href=beCPG.util.entityURL(r.options.siteId,r.doclistMetadata.parent.nodeRef,r.doclistMetadata.parent.type)});f.removeClass(r.id+"-becpg-entityFolder-buttons","hidden");f.removeClass(r.id+"-becpg-entityFolder-instructions","hidden")}else{f.addClass(r.id+"-becpg-entityFolder-instructions","hidden")}},onLikes:function l(s){var p=s;if(typeof this.viewRenderers[this.options.viewRendererName]==="object"){p=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,s)}var t=this.widgets.dataTable.getRecord(p),q=t.getData(),r=q.jsNode.nodeRef,n=q.likes;n.isLiked=!n.isLiked;n.totalLikes+=(n.isLiked?1:-1);var u={successCallback:{fn:function m(B,y){var C=B.json.data;if(C){var A=this._findRecordByParameter(y,"nodeRef"),v=A.getData(),z=v.node,w=v.likes;w.totalLikes=C.ratingsCount;this.widgets.dataTable.updateRow(A,v);if(w.isLiked){var x={fileName:v.fileName,nodeRef:z.nodeRef};if(beCPG.util.isEntity(v)){this.modules.actions.postActivity(this.options.siteId,"entity-liked","entity-data-lists",x)}else{if(z.isContainer){this.modules.actions.postActivity(this.options.siteId,"folder-liked","folder-details",x)}else{this.modules.actions.postActivity(this.options.siteId,"file-liked","document-details",x)}}}}},scope:this,obj:r.toString()},failureCallback:{fn:function o(z,x){var y=this._findRecordByParameter(x,"nodeRef"),v=y.getData(),w=v.likes;w.isLiked=!w.isLiked;w.totalLikes+=(w.isLiked?1:-1);this.widgets.dataTable.updateRow(y,v);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",v.displayName)})},scope:this,obj:r.toString()}};if(n.isLiked){this.services.likes.set(r,1,u)}else{this.services.likes.remove(r,u)}this.widgets.dataTable.updateRow(t,q)}});Alfresco.DocumentList.generateFileFolderLinkMarkup=function i(o,m){var q=m.jsNode,n;if(q.isLink&&a(o.options.siteId)&&m.location.site&&m.location.site.name!==o.options.siteId){if(q.isContainer){n=e("documentlibrary?path="+encodeURIComponent(m.location.path),{site:m.location.site.name})}else{n=o.getActionUrls(m,m.location.site.name).documentDetailsUrl}}else{if(q.isContainer){if(beCPG.util.isEntity(m)){n=o.getActionUrls(m).documentDetailsUrl.replace("document-details?","entity-data-lists?list=View-properties&")}else{if(m.parent.isContainer){n='#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(m.location)}else{if(m.location.path==="/"){n='#" class="filter-change" rel="'+Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:d(m.location.path,"")})}else{n="#"}}}}else{var p=o.getActionUrls(m);if(q.isLink&&q.linkedNode.isContainer){n=p.folderDetailsUrl}else{n=p.documentDetailsUrl}}}return'<a href="'+n+'">'};Alfresco.DocumentListSimpleViewRenderer.prototype.renderCellThumbnail=function h(z,y,B,w,s){var v=B.getData(),t=v.jsNode,o=v.displayName,r=t.isContainer,u=t.isLink,x=o.substring(o.lastIndexOf(".")),A=beCPG.util.isEntity(v),n=t.nodeRef.nodeRef;if(A){x=t.type.substring(t.type.lastIndexOf(":"))}w.width=40;f.setStyle(y,"width",w.width+"px");f.setStyle(y.parentNode,"width",w.width+"px");if(r&&!A){y.innerHTML='<span class="folder-small">'+(u?'<span class="link"></span>':"")+(z.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(z,v)+'<img id="'+n+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-32.png" /></a>';containerTarget=new YAHOO.util.DDTarget(n)}else{var q=z.id+"-preview-"+B.getId();var m=Alfresco.util.getFileIcon(o,t.type);if(m=="generic-file-32.png"){m=Alfresco.util.getFileIconByMimetype(t.mimetype)}y.innerHTML='<span id="'+q+'" class="icon32">'+(u?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(z,v)+'<img id="'+n+'" src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+m+'" alt="'+x+'" title="'+c(o)+'" /></a></span>';z.previewTooltips.push(q)}var p=new Alfresco.DnD(n,z)};Alfresco.DocumentListViewRenderer.prototype.renderCellThumbnail=function j(y,x,A,u,q){var t=A.getData(),r=t.jsNode,n=t.displayName,p=r.isContainer,s=r.isLink,v=n.substring(n.lastIndexOf(".")),z=beCPG.util.isEntity(t),m=r.nodeRef.nodeRef;u.width=this.thumbnailColumnWidth;f.setStyle(x,"width",u.width+"px");f.setStyle(x.parentNode,"width",u.width+"px");var w;if(window.location.href.search(/\/sharedfiles/)!=-1&&t.location.path.search("/Shared")==0){t.location.path=t.location.path.substring(7)}else{if(window.location.href.search(/\/myfiles/)!=-1&&t.location.path.search("/User Homes")==0){t.location.path="/"+t.location.path.split("/").slice(3).join("/")}}if((p||(s&&r.linkedNode.isContainer))&&!z){x.innerHTML='<span class="folder">'+(s?'<span class="link"></span>':"")+(y.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(y,t)+'<img id="'+m+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-64.png" /></a>';w=new YAHOO.util.DDTarget(m)}else{x.innerHTML='<span class="thumbnail">'+(s?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(y,t)+'<img id="'+m+'" src="'+Alfresco.DocumentList.generateThumbnailUrl(t)+'" alt="'+v+'" title="'+c(n)+'" /></a></span>'}var o=new Alfresco.DnD(m,y)};Alfresco.DocumentList.generateLikes=function k(p,m){var q=m.node,n=m.likes,r="like."+(q.isContainer&&!beCPG.util.isEntity(m)?"folder.":"document."),o="";if(n.isLiked){o='<a class="like-action enabled" title="'+p.msg(r+"remove.tip")+'" tabindex="0"></a>'}else{o='<a class="like-action" title="'+p.msg(r+"add.tip")+'" tabindex="0">'+p.msg(r+"add.label")+"</a>"}o+='<span class="likes-count">'+c(n.totalLikes)+"</span>";return o};Alfresco.DocumentList.generateComments=function g(p,m){var s=m.node,r=p.getActionUrls(m),n=r[s.isContainer?"folderDetailsUrl":"documentDetailsUrl"]+"#comment",t="comment."+(s.isContainer&&!beCPG.util.isEntity(m)?"folder.":"document.");if(beCPG.util.isEntity(m)){n=n.replace("folder-details?","entity-data-lists?list=View-properties&")}var q=(s.properties["fm:commentCount"]!==undefined);var o='<a href="'+n+'" class="comment'+(q?" hasComments":"")+'" title="'+p.msg(t+"tip")+'" tabindex="0">'+p.msg(t+"label")+"</a>";if(q){o+='<span class="comment-count">'+c(s.properties["fm:commentCount"])+"</span>"}return o}})();