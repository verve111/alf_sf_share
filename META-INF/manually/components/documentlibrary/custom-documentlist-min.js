!function(){var a=YAHOO.util.Dom,b=Alfresco.util.encodeHTML,c=Alfresco.util.combinePaths,d=Alfresco.util.siteURL,e=Alfresco.util.isValueSet;beCPG.custom.DocumentList=function(b){return beCPG.custom.DocumentList.superclass.constructor.call(this,b),YAHOO.Bubbling.on("doclistMetadata",this.onDoclistMetadata,this),this},YAHOO.extend(beCPG.custom.DocumentList,Alfresco.DocumentList,{onDoclistMetadata:function(b,c){var d=c[1].metadata,e=this;if(null!==d&&beCPG.util.isEntity(d.parent)){var h,f=a.get(e.id+"-becpg-entityFolder-message"),g=d.parent.type.split(":")[1],i="product";i="rawMaterial"==g||"finishedProduct"==g||"semiFinishedProduct"==g||"localSemiFinishedProduct"==g||"packagingKit"==g||"packagingMaterial"==g||"resourceProduct"==g?"product":"projet"==g||"systemEntity"==g||"aclGroup"==g||"entityTplFolder"==g?g:"entity",h="<img  src='"+Alfresco.constants.PROXY_URI+"/api/node/"+d.parent.nodeRef.replace(":/","")+"/content/thumbnails/doclib?c=queue&ph=true' class='node-thumbnail' width='48'>",h+="<span >"+Alfresco.util.message("page.documentlibrary.instructions."+i)+"</span>",f.innerHTML=h,this.widgets.viewEntityLists=Alfresco.util.createYUIButton(e,"viewEntityLists-button",function(a,b,c){window.location.href=beCPG.util.entityURL(e.options.siteId,e.doclistMetadata.parent.nodeRef,e.doclistMetadata.parent.type)}),a.removeClass(e.id+"-becpg-entityFolder-buttons","hidden"),a.removeClass(e.id+"-becpg-entityFolder-instructions","hidden")}else a.addClass(e.id+"-becpg-entityFolder-instructions","hidden")},_buildDocListParams:function(b){var d=e(this.options.siteId),f={path:this.currentPath,type:this.options.showFolders?"all":"documents",site:this.options.siteId,container:this.options.containerId,filter:this.currentFilter};this.options.disableSiteMode&&(d=!1),this.options.usePagination&&(f.page=this.widgets.paginator.getCurrentPage()||this.currentPage,f.pageSize=this.widgets.paginator.getRowsPerPage()),"object"==typeof b&&(f=YAHOO.lang.merge(f,b));var g="alfresco://company/shared"==this.options.rootNode,h=d?"site/{site}/{container}":g?"node/alfresco/company/shared":"node/alfresco/user/home",i=YAHOO.lang.substitute("{type}/"+h+("path"===f.filter.filterId?"{path}":""),{type:encodeURIComponent(f.type),site:encodeURIComponent(f.site),container:encodeURIComponent(f.container),path:c("/",Alfresco.util.encodeURIPath(f.path))});return i+="?filter="+encodeURIComponent(f.filter.filterId),f.filter.filterData&&"path"!==f.filter.filterId&&(i+="&filterData="+encodeURIComponent(f.filter.filterData)),this.options.usePagination&&(i+="&size="+f.pageSize+"&pos="+f.page),i+="&sortAsc="+this.options.sortAscending+"&sortField="+encodeURIComponent(this.options.sortField),d||(i+="&libraryRoot="+encodeURIComponent(this.options.rootNode.toString())),i+="&view="+this.actionsView+"&noCache="+(new Date).getTime()},onDocumentListDrop:function(d){try{if(void 0!==d.dataTransfer.files&&null!==d.dataTransfer.files&&d.dataTransfer.files.length>0){var i,j,f=Alfresco.getDNDUploadProgressInstance(),g=!1,h="";for(j=d.dataTransfer.files.length,i=0;i<j;i++)d.dataTransfer.files[i].size>0?g=!0:h+='"'+d.dataTransfer.files[i].fileName+'", ';if(g||(h=h.substring(0,h.lastIndexOf(", ")),Alfresco.util.PopupManager.displayMessage({text:f.msg("message.zeroByteFiles",h)})),g&&f.uploadMethod===f.INMEMORY_UPLOAD){var k=0;for(j=d.dataTransfer.files.length,i=0;i<j;i++)k+=d.dataTransfer.files[i].size;k>f.getInMemoryLimit()&&(g=!1,Alfresco.util.PopupManager.displayPrompt({text:f.msg("inmemory.uploadsize.exceeded",Alfresco.util.formatFileSize(f.getInMemoryLimit()))}))}if(g){var l=this.currentPath,m=l.substring(l.lastIndexOf("/")+1),n=this.doclistMetadata.parent?this.doclistMetadata.parent.nodeRef:null,o=this.widgets.dataTable.getRecord(d.target);if(null!==o){var q=(this.widgets.dataTable.getColumn(d.target),o.getData());if("IMG"==d.target.tagName||"droppable"==d.target.className){var r=q.location;m=r.file,l=c(r.path,r.file),n=q.nodeRef}}a.removeClass(this.widgets.dataTable.getTrEl(d.target),"dndFolderHighlight"),a.removeClass(this.widgets.dataTable.getContainerEl(),"dndDocListHighlight");var s={files:d.dataTransfer.files,uploadDirectoryName:m,filter:[],mode:f.MODE_MULTI_UPLOAD,thumbnails:"doclib",onFileUploadComplete:{fn:this.onFileUploadComplete,scope:this}};e(this.options.siteId)&&!this.options.disableSiteMode?(s.siteId=this.options.siteId,s.containerId=this.options.containerId,s.uploadDirectory=l):s.destination=n,f.show(s)}}else Alfresco.logger.debug("DL_onDocumentListDrop: A drop event was detected, but no files were present for upload: ",d.dataTransfer)}catch(a){Alfresco.logger.error("DL_onDocumentListDrop: The following error occurred when files were dropped onto the Document List: ",a)}d.stopPropagation(),d.preventDefault()},onLikes:function(b){var c=b;"object"==typeof this.viewRenderers[this.options.viewRendererName]&&(c=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,b));var d=this.widgets.dataTable.getRecord(c),e=d.getData(),f=e.jsNode.nodeRef,g=e.likes;g.isLiked=!g.isLiked,g.totalLikes+=g.isLiked?1:-1;var h={successCallback:{fn:function(b,c){var d=b.json.data;if(d){var e=this._findRecordByParameter(c,"nodeRef"),f=e.getData(),g=f.node,h=f.likes;if(h.totalLikes=d.ratingsCount,this.widgets.dataTable.updateRow(e,f),h.isLiked){var i={fileName:f.fileName,nodeRef:g.nodeRef};beCPG.util.isEntity(f)?this.modules.actions.postActivity(this.options.siteId,"entity-liked","entity-data-lists",i):g.isContainer?this.modules.actions.postActivity(this.options.siteId,"folder-liked","folder-details",i):this.modules.actions.postActivity(this.options.siteId,"file-liked","document-details",i)}}},scope:this,obj:f.toString()},failureCallback:{fn:function(b,c){var d=this._findRecordByParameter(c,"nodeRef"),e=d.getData(),f=e.likes;f.isLiked=!f.isLiked,f.totalLikes+=f.isLiked?1:-1,this.widgets.dataTable.updateRow(d,e),Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",e.displayName)})},scope:this,obj:f.toString()}};g.isLiked?this.services.likes.set(f,1,h):this.services.likes.remove(f,h),this.widgets.dataTable.updateRow(d,e)}}),Alfresco.DocumentList.generateFileFolderLinkMarkup=function(b,f){var h,g=f.jsNode;if(g.isLink&&e(b.options.siteId)&&f.location.site&&f.location.site.name!==b.options.siteId)h=g.isContainer?d("documentlibrary?path="+encodeURIComponent(f.location.path),{site:f.location.site.name}):b.getActionUrls(f,f.location.site.name).documentDetailsUrl;else if(g.isContainer)h=beCPG.util.isEntity(f)?'#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(f.location):f.parent.isContainer?'#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(f.location):"/"===f.location.path?'#" class="filter-change" rel="'+Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:c(f.location.path,"")}):"#";else{var i=b.getActionUrls(f);e(b.options.siteId)&&(null!=f.location.repoPath&&f.location.repoPath.length>0&&0==f.location.repoPath.indexOf("/Sites/"+b.options.siteId)||null!=f.location.path&&f.location.path.length>0&&!e(f.location.site))&&(i=b.getActionUrls(f,b.options.siteId)),h=g.isLink&&g.linkedNode.isContainer?i.folderDetailsUrl:i.documentDetailsUrl}return'<a href="'+h+'">'},Alfresco.DocumentListSimpleViewRenderer.prototype.renderCellThumbnail=function(d,e,f,g,h){var i=f.getData(),j=i.jsNode,l=(j.properties,i.displayName),m=j.isContainer,n=j.isLink,o=l.substring(l.lastIndexOf(".")),p=j.nodeRef.nodeRef,q=beCPG.util.isEntity(i);q&&(o=j.type.substring(j.type.lastIndexOf(":")));var r;if(g.width=40,a.setStyle(e,"width",g.width+"px"),a.setStyle(e.parentNode,"width",g.width+"px"),m&&!q)e.innerHTML='<span class="folder-small">'+(n?'<span class="link"></span>':"")+(d.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(d,i)+'<img id="'+p+'" src="'+this.getFolderIcon(i.node)+'" /></a>',r=new YAHOO.util.DDTarget(p);else{var s=d.id+"-preview-"+f.getId(),t=Alfresco.util.getFileIcon(l,j.type);"generic-file-32.png"==t&&(t=Alfresco.util.getFileIconByMimetype(j.mimetype)),e.innerHTML='<span id="'+s+'" class="icon32">'+(n?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(d,i)+'<img id="'+p+'" src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+t+'" alt="'+o+'" title="'+b(l)+'" /></a></span>',d.previewTooltips.push(s)}new Alfresco.DnD(p,d)},Alfresco.DocumentListViewRenderer.prototype.renderCellThumbnail=function(d,e,f,g,h){var r,i=f.getData(),j=i.jsNode,l=(j.properties,i.displayName),m=j.isContainer,n=beCPG.util.isEntity(i),o=j.isLink,p=l.substring(l.lastIndexOf(".")),q=j.nodeRef.nodeRef;window.location.href.search(/\/sharedfiles/)!=-1&&0==i.location.path.search("/Shared")&&(i.location.path=i.location.path.substring(7)),g.width=this.thumbnailColumnWidth,a.setStyle(e,"width",g.width+"px"),a.setStyle(e.parentNode,"width",g.width+"px"),(m||o&&j.linkedNode.isContainer)&&!n?(e.innerHTML='<span class="folder">'+(o?'<span class="link"></span>':"")+(d.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(d,i)+'<img id="'+q+'" src="'+this.getFolderIcon(i.node)+'" /></a>',r=new YAHOO.util.DDTarget(q)):e.innerHTML='<span class="thumbnail">'+(o?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(d,i)+'<img id="'+q+'" src="'+Alfresco.DocumentList.generateThumbnailUrl(i)+'" alt="'+p+'" title="'+b(l)+'" /></a></span>';new Alfresco.DnD(q,d)},Alfresco.DocumentList.generateLikes=function(c,d){var e=d.node,f=d.likes,g="like."+(e.isContainer&&!beCPG.util.isEntity(d)?"folder.":"document."),h="";return h=f.isLiked?'<a class="like-action enabled" title="'+c.msg(g+"remove.tip")+'" tabindex="0"></a>':'<a class="like-action" title="'+c.msg(g+"add.tip")+'" tabindex="0">'+c.msg(g+"add.label")+"</a>",h+='<span class="likes-count">'+b(f.totalLikes)+"</span>"},Alfresco.DocumentList.generateComments=function(c,d){var e=d.node,f=c.getActionUrls(d),g=f[e.isContainer?"folderDetailsUrl":"documentDetailsUrl"]+"#comment",h="comment."+(e.isContainer&&!beCPG.util.isEntity(d)?"folder.":"document.");beCPG.util.isEntity(d)&&(g=g.replace("folder-details?","entity-data-lists?list=View-properties&"));var i=void 0!==e.properties["fm:commentCount"],j='<a href="'+g+'" class="comment'+(i?" hasComments":"")+'" title="'+c.msg(h+"tip")+'" tabindex="0">'+c.msg(h+"label")+"</a>";return i&&(j+='<span class="comment-count">'+b(e.properties["fm:commentCount"])+"</span>"),j}}();