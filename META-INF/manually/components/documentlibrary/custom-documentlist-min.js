!function(){var e=YAHOO.util.Dom,t=Alfresco.util.encodeHTML,i=Alfresco.util.combinePaths,s=Alfresco.util.siteURL,n=Alfresco.util.isValueSet;beCPG.custom.DocumentList=function(e){return beCPG.custom.DocumentList.superclass.constructor.call(this,e),YAHOO.Bubbling.on("doclistMetadata",this.onDoclistMetadata,this),this},YAHOO.extend(beCPG.custom.DocumentList,Alfresco.DocumentList,{onDoclistMetadata:function(t,i){var s=i[1].metadata,n=this;if(null!==s&&beCPG.util.isEntity(s.parent)){var a,o=e.get(n.id+"-becpg-entityFolder-message"),l=s.parent.type.split(":")[1],r="product";r="rawMaterial"==l||"finishedProduct"==l||"semiFinishedProduct"==l||"localSemiFinishedProduct"==l||"packagingKit"==l||"packagingMaterial"==l||"resourceProduct"==l?"product":"projet"==l||"systemEntity"==l||"aclGroup"==l||"entityTplFolder"==l?l:"entity",a="<img  src='"+Alfresco.constants.PROXY_URI+"/api/node/"+s.parent.nodeRef.replace(":/","")+"/content/thumbnails/doclib?c=queue&ph=true' class='node-thumbnail' width='48'>",a+="<span >"+Alfresco.util.message("page.documentlibrary.instructions."+r)+"</span>",o.innerHTML=a,this.widgets.viewEntityLists=Alfresco.util.createYUIButton(n,"viewEntityLists-button",function(e,t,i){window.location.href=beCPG.util.entityURL(n.options.siteId,n.doclistMetadata.parent.nodeRef,n.doclistMetadata.parent.type)}),e.removeClass(n.id+"-becpg-entityFolder-buttons","hidden"),e.removeClass(n.id+"-becpg-entityFolder-instructions","hidden")}else e.addClass(n.id+"-becpg-entityFolder-instructions","hidden")},onLikes:function(e){var t=e;"object"==typeof this.viewRenderers[this.options.viewRendererName]&&(t=this.viewRenderers[this.options.viewRendererName].getDataTableRecordIdFromRowElement(this,e));var i=this.widgets.dataTable.getRecord(t),s=i.getData(),n=s.jsNode.nodeRef,a=s.likes;a.isLiked=!a.isLiked,a.totalLikes+=a.isLiked?1:-1;var o={successCallback:{fn:function(e,t){var i=e.json.data;if(i){var s=this._findRecordByParameter(t,"nodeRef"),n=s.getData(),a=n.node,o=n.likes;if(o.totalLikes=i.ratingsCount,this.widgets.dataTable.updateRow(s,n),o.isLiked){var l={fileName:n.fileName,nodeRef:a.nodeRef};beCPG.util.isEntity(n)?this.modules.actions.postActivity(this.options.siteId,"entity-liked","entity-data-lists",l):a.isContainer?this.modules.actions.postActivity(this.options.siteId,"folder-liked","folder-details",l):this.modules.actions.postActivity(this.options.siteId,"file-liked","document-details",l)}}},scope:this,obj:n.toString()},failureCallback:{fn:function(e,t){var i=this._findRecordByParameter(t,"nodeRef"),s=i.getData(),n=s.likes;n.isLiked=!n.isLiked,n.totalLikes+=n.isLiked?1:-1,this.widgets.dataTable.updateRow(i,s),Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",s.displayName)})},scope:this,obj:n.toString()}};a.isLiked?this.services.likes.set(n,1,o):this.services.likes.remove(n,o),this.widgets.dataTable.updateRow(i,s)}}),Alfresco.DocumentList.generateFileFolderLinkMarkup=function(e,t){var a,o=t.jsNode;if(o.isLink&&n(e.options.siteId)&&t.location.site&&t.location.site.name!==e.options.siteId)a=o.isContainer?s("documentlibrary?path="+encodeURIComponent(t.location.path),{site:t.location.site.name}):e.getActionUrls(t,t.location.site.name).documentDetailsUrl;else if(o.isContainer)a=beCPG.util.isEntity(t)?e.getActionUrls(t).documentDetailsUrl.replace("document-details?","entity-data-lists?list=taskList&"):t.parent.isContainer?'#" class="filter-change" rel="'+Alfresco.DocumentList.generatePathMarkup(t.location):"/"===t.location.path?'#" class="filter-change" rel="'+Alfresco.DocumentList.generateFilterMarkup({filterId:"path",filterData:i(t.location.path,"")}):"#";else{var l=e.getActionUrls(t);a=o.isLink&&o.linkedNode.isContainer?l.folderDetailsUrl:l.documentDetailsUrl}return'<a href="'+a+'">'},Alfresco.DocumentListSimpleViewRenderer.prototype.renderCellThumbnail=function(i,s,n,a,o){var l=n.getData(),r=l.jsNode,c=l.displayName,d=r.isContainer,p=r.isLink,u=c.substring(c.lastIndexOf(".")),m=beCPG.util.isEntity(l),f=r.nodeRef.nodeRef;if(m&&(u=r.type.substring(r.type.lastIndexOf(":"))),a.width=40,e.setStyle(s,"width",a.width+"px"),e.setStyle(s.parentNode,"width",a.width+"px"),d&&!m)s.innerHTML='<span class="folder-small">'+(p?'<span class="link"></span>':"")+(i.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(i,l)+'<img id="'+f+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-32.png" /></a>',containerTarget=new YAHOO.util.DDTarget(f);else{var h=i.id+"-preview-"+n.getId(),g=Alfresco.util.getFileIcon(c,r.type);"generic-file-32.png"==g&&(g=Alfresco.util.getFileIconByMimetype(r.mimetype)),s.innerHTML='<span id="'+h+'" class="icon32">'+(p?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(i,l)+'<img id="'+f+'" src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+g+'" alt="'+u+'" title="'+t(c)+'" /></a></span>',i.previewTooltips.push(h)}new Alfresco.DnD(f,i)},Alfresco.DocumentListViewRenderer.prototype.renderCellThumbnail=function(i,s,n,a,o){var l=n.getData(),r=l.jsNode,c=l.displayName,d=r.isContainer,p=r.isLink,u=c.substring(c.lastIndexOf(".")),m=beCPG.util.isEntity(l),f=r.nodeRef.nodeRef;a.width=this.thumbnailColumnWidth,e.setStyle(s,"width",a.width+"px"),e.setStyle(s.parentNode,"width",a.width+"px");var h;-1!=window.location.href.search(/\/sharedfiles/)&&0==l.location.path.search("/Shared")?l.location.path=l.location.path.substring(7):-1!=window.location.href.search(/\/myfiles/)&&0==l.location.path.search("/User Homes")&&(l.location.path="/"+l.location.path.split("/").slice(3).join("/")),(d||p&&r.linkedNode.isContainer)&&!m?(s.innerHTML='<span class="folder">'+(p?'<span class="link"></span>':"")+(i.dragAndDropEnabled?'<span class="droppable"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(i,l)+'<img id="'+f+'" src="'+Alfresco.constants.URL_RESCONTEXT+'components/documentlibrary/images/folder-64.png" /></a>',h=new YAHOO.util.DDTarget(f)):s.innerHTML='<span class="thumbnail">'+(p?'<span class="link"></span>':"")+Alfresco.DocumentList.generateFileFolderLinkMarkup(i,l)+'<img id="'+f+'" src="'+Alfresco.DocumentList.generateThumbnailUrl(l)+'" alt="'+u+'" title="'+t(c)+'" /></a></span>';new Alfresco.DnD(f,i)},Alfresco.DocumentList.generateLikes=function(e,i){var s=i.node,n=i.likes,a="like."+(s.isContainer&&!beCPG.util.isEntity(i)?"folder.":"document."),o="";return o=n.isLiked?'<a class="like-action enabled" title="'+e.msg(a+"remove.tip")+'" tabindex="0"></a>':'<a class="like-action" title="'+e.msg(a+"add.tip")+'" tabindex="0">'+e.msg(a+"add.label")+"</a>",o+='<span class="likes-count">'+t(n.totalLikes)+"</span>"},Alfresco.DocumentList.generateComments=function(e,i){var s=i.node,n=e.getActionUrls(i),a=n[s.isContainer?"folderDetailsUrl":"documentDetailsUrl"]+"#comment",o="comment."+(s.isContainer&&!beCPG.util.isEntity(i)?"folder.":"document.");beCPG.util.isEntity(i)&&(a=a.replace("folder-details?","entity-data-lists?list=View-properties&"));var l=void 0!==s.properties["fm:commentCount"],r='<a href="'+a+'" class="comment'+(l?" hasComments":"")+'" title="'+e.msg(o+"tip")+'" tabindex="0">'+e.msg(o+"label")+"</a>";return l&&(r+='<span class="comment-count">'+t(s.properties["fm:commentCount"])+"</span>"),r}}();