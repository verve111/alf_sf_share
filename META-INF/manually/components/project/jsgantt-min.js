var JSGantt;JSGantt||(JSGantt={}),JSGantt.PREF_GANTT_FORMAT="fr.becpg.gantt.format",function(){JSGantt.register=function(t){JSGantt.scope=t,JSGantt.msg=function(e){return Alfresco.util.message.call(t,e,t.name,Array.prototype.slice.call(arguments).slice(1))}},JSGantt.TaskItem=function(t,e,n,a,r,i,s,o,l,u,h,d,c,m,p){var f=t,D=e,v=JSGantt.parseDateStr(n,g.getDateInputFormat()),S=JSGantt.parseDateStr(a,g.getDateInputFormat()),y=r,M=p,G=i,w=s,b=o,F=l,J=u,T=h,C=d,k=c,Y=m,x=0,E=0,L=1,I=0,_=0,j=0,O=0;this.getID=function(){return f},this.getName=function(){return D},this.getStart=function(){return v},this.getEnd=function(){return w?v:S},this.getColor=function(){return y},this.getLineColor=function(){return M},this.getLink=function(){return G},this.getMile=function(){return w},this.getDepend=function(){return k?k:null},this.getCaption=function(){return Y?Y:""},this.getResource=function(){return"undefined"!=typeof b&&null!==b?b:"&nbsp;"},this.getCompVal=function(){return F?F:0},this.getCompStr=function(){return F?F+"%":""},this.getDuration=function(t){var e=null,n=null;return w?n="-":"hour"===t?(e=Math.ceil((this.getEnd()-this.getStart())/36e5),n=1===e?"1 "+JSGantt.msg("jsgantt.hour"):e+" "+JSGantt.msg("jsgantt.hours")):"minute"===t?(e=Math.ceil((this.getEnd()-this.getStart())/6e4),n=1===e?"1 "+JSGantt.msg("jsgantt.minute"):e+" "+JSGantt.msg("jsgantt.minutes")):(e=Math.ceil((this.getEnd()-this.getStart())/864e5+1),n=1===e?"1 "+JSGantt.msg("jsgantt.day"):e+" "+JSGantt.msg("jsgantt.days")),n},this.getParent=function(){return T},this.getGroup=function(){return J},this.getOpen=function(){return C},this.getLevel=function(){return x},this.getNumKids=function(){return E},this.getStartX=function(){return I},this.getStartY=function(){return _},this.getEndX=function(){return j},this.getEndY=function(){return O},this.getVisible=function(){return L},this.setDepend=function(t){k=t},this.setStart=function(t){v=t},this.setEnd=function(t){S=t},this.setLevel=function(t){x=t},this.setNumKid=function(t){E=t},this.setCompVal=function(t){F=t},this.setStartX=function(t){I=t},this.setStartY=function(t){_=t},this.setEndX=function(t){j=t},this.setEndY=function(t){O=t},this.setOpen=function(t){C=t},this.setVisible=function(t){L=t}},JSGantt.GanttChart=function(t,e,n){var a=new Alfresco.service.Preferences,r=t,i=e,s="day";null!=n&&n.length>0?s=n:(s=Alfresco.util.findValueByDotNotation(a.get(),JSGantt.PREF_GANTT_FORMAT),s||(s="day"));var o=0,l=1,u=1,h=0,d=0,c=1,m=1,p="mm/dd/yyyy",f="mm/dd/yy",D=0,v="",S=1,y=[],M=["day","week","month","quarter"],G=[1,1,1,2,2,2,3,3,3,4,4,4],w=[31,28,31,30,31,30,31,31,30,31,30,31],b=Alfresco.util.message("months.long").split(",");this.setFormatArr=function(){M=new Array;for(var t=0;t<arguments.length;t++)M[t]=arguments[t];M.length>4&&(M.length=4)},this.setShowRes=function(t){o=t},this.setShowDur=function(t){l=t},this.setShowSelect=function(t){c=t},this.setColWidthFactor=function(t){m=t},this.setShowComp=function(t){u=t},this.setShowStartDate=function(t){h=t},this.setShowEndDate=function(t){d=t},this.setDateInputFormat=function(t){p=t},this.setDateDisplayFormat=function(t){f=t},this.setCaptionType=function(t){v=t},this.setFormat=function(t){s=t,a.set(JSGantt.PREF_GANTT_FORMAT,t),this.Draw()},this.getFormat=function(){return s},this.getShowRes=function(){return o},this.getShowDur=function(){return l},this.getShowComp=function(){return u},this.getShowStartDate=function(){return h},this.getShowEndDate=function(){return d},this.getDateInputFormat=function(){return p},this.getDateDisplayFormat=function(){return f},this.getCaptionType=function(){return v},this.CalcTaskXY=function(){for(var t=this.getList(),e=0;e<t.length;e++)vcurrDivID=t[e].getID(),vTaskDiv=document.getElementById("taskbar_"+vcurrDivID),vBarDiv=document.getElementById("bardiv_"+vcurrDivID),vParDiv=document.getElementById("childgrid_"+vcurrDivID),vBarDiv&&(t[e].setStartX(vBarDiv.offsetLeft),t[e].setStartY(vParDiv.offsetTop+vBarDiv.offsetTop+6),t[e].setEndX(vBarDiv.offsetLeft+vBarDiv.offsetWidth),t[e].setEndY(vParDiv.offsetTop+vBarDiv.offsetTop+6))},this.AddTaskItem=function(t){y.push(t)},this.getList=function(){return y},this.clearDependencies=function(){for(var t,e=document.getElementById("rightside"),n=S,a=1;n>a;a++)t=document.getElementById("line"+a),t&&e.removeChild(t);S=1},this.scrollToY=function(t){if(t){var e=document.getElementById("rightside");e.scrollLeft=t}},this.sLine=function(t,e,n,a){vLeft=Math.min(t,n),vTop=Math.min(e,a),vWid=Math.abs(n-t)+1,vHgt=Math.abs(a-e)+1,vDoc=document.getElementById("rightside");var r=document.createElement("div");r.className="ggline",r.id="line"+S++,r.style.left=vLeft+"px",r.style.top=vTop+"px",r.style.width=vWid+"px",r.style.height=vHgt+"px",vDoc.appendChild(r)},this.dLine=function(t,e,n,a){var r=n-t,i=a-e,s=t,o=e,g=Math.max(Math.abs(r),Math.abs(i));r/=g,i/=g;for(var l=0;g>=l;l++)vx=Math.round(s),vy=Math.round(o),this.sLine(vx,vy,vx,vy),s+=r,o+=i},this.drawDependency=function(t,e,n,a){n>t+10?(this.sLine(t,e,t+4,e),this.sLine(t+4,e,t+4,a),this.sLine(t+4,a,n,a),this.dLine(n,a,n-3,a-3),this.dLine(n,a,n-3,a+3),this.dLine(n-1,a,n-3,a-2),this.dLine(n-1,a,n-3,a+2)):(this.sLine(t,e,t+4,e),this.sLine(t+4,e,t+4,a-10),this.sLine(t+4,a-10,n-8,a-10),this.sLine(n-8,a-10,n-8,a),this.sLine(n-8,a,n,a),this.dLine(n,a,n-3,a-3),this.dLine(n,a,n-3,a+3),this.dLine(n-1,a,n-3,a-2),this.dLine(n-1,a,n-3,a+2))},this.DrawDependencies=function(){this.CalcTaskXY(),this.clearDependencies();for(var t=this.getList(),e=0;e<t.length;e++)if(vDepend=t[e].getDepend(),vDepend)for(var n=vDepend+"",a=n.split(","),r=a.length,i=0;r>i;i++){var s=this.getArrayLocationByID(a[i]);null!=s&&1==t[s].getVisible()&&1==t[e].getVisible()&&(t[s].getMile()?this.drawDependency(t[s].getEndX()-251,t[s].getEndY()+1,t[e].getStartX()-1,t[e].getStartY()+1):this.drawDependency(t[s].getEndX()+1,t[s].getEndY()+1,t[e].getStartX()-1,t[e].getStartY()+1))}},this.getArrayLocationByID=function(t){for(var e=this.getList(),n=0;n<e.length;n++)if(e[n].getID()==t)return n;return null},this.Draw=function(){try{var t=new Date,e=new Date,n=new Date,a=new Date,p=new Date,v=0,S=0,F=0,J=0,T="",C="",k="",Y="",x="",E=0,L=0,I=0,_=0,j=0,O="";if(y.length>0){JSGantt.processRows(y,0,-1,1,1),e=JSGantt.getMinDate(y,s),t=JSGantt.getMaxDate(y,s),"day"==s?(E=22*m,L=1):"week"==s?(E=37*m,L=7):"month"==s?(E=37*m,L=30):"quarter"==s?(E=60*m,L=90):"hour"==s?(E=22*m,L=1):"minute"==s&&(E=22*m,L=1),_=(t.getTime()-e.getTime())/864e5,D=_/L,I=D*E+1,j=E/L+1/L,T='<div class="yui-gd yui-dt">',C='<div class="yui-u first" id="leftside"><table cellSpacing="0" cellPadding="0" border="0"><thead>',C+='<tr class="gheader">',C+='<th  colspan="5">'+JSGantt.msg("jsgantt.format")+":&nbsp;",-1!=M.join().indexOf("minute")&&(C+="minute"==s?'<input type="radio" name="radFormat" value="minute" checked>'+JSGantt.msg("jsgantt.minute"):'<input type="radio" name="radFormat" onclick="JSGantt.changeFormat(\'minute\','+r+');" value="minute">'+JSGantt.msg("jsgantt.minute")),-1!=M.join().indexOf("hour")&&(C+="hour"==s?'<input type="radio" name="radFormat" value="hour" checked>'+JSGantt.msg("jsgantt.hour"):'<input type="radio" name="radFormat" onclick="JSGantt.changeFormat(\'hour\','+r+');" value="hour">'+JSGantt.msg("jsgantt.hour")),-1!=M.join().indexOf("day")&&(C+="day"==s?'<input type="radio" name="radFormat" value="day" checked>'+JSGantt.msg("jsgantt.day"):'<input type="radio" name="radFormat" onclick="JSGantt.changeFormat(\'day\','+r+');" value="day">'+JSGantt.msg("jsgantt.day")),-1!=M.join().indexOf("week")&&(C+="week"==s?'<input type="radio" name="radFormat" value="week" checked>'+JSGantt.msg("jsgantt.week"):'<input type="radio" name="radFormat" onclick="JSGantt.changeFormat(\'week\','+r+');" value="week">'+JSGantt.msg("jsgantt.week")),-1!=M.join().indexOf("month")&&(C+="month"==s?'<input type="radio" name="radFormat" value="month" checked>'+JSGantt.msg("jsgantt.month"):'<input type="radio" name="radFormat" onclick="JSGantt.changeFormat(\'month\','+r+');" value="month">'+JSGantt.msg("jsgantt.month")),-1!=M.join().indexOf("quarter")&&(C+="quarter"==s?'<input type="radio" name="radFormat" value="quarter" checked>'+JSGantt.msg("jsgantt.quarter"):'<input type="radio" name="radFormat" onclick="JSGantt.changeFormat(\'quarter\','+r+');" value="quarter">'+JSGantt.msg("jsgantt.quarter")),C+="</th></tr>",C+='<tr class="gheader"> <th colspan="2"><nobr></nobr></th>',1===o&&(C+="  <th nowrap >"+JSGantt.msg("jsgantt.resource")+"</th>"),1===l&&(C+="  <th  nowrap >"+JSGantt.msg("jsgantt.duration")+"</th>"),1===u&&(C+="  <th  nowrap >"+JSGantt.msg("jsgantt.percomp")+"</th>"),1===h&&(C+="  <th nowrap >"+JSGantt.msg("jsgantt.begin")+"</th>"),1===d&&(C+="  <th>"+JSGantt.msg("jsgantt.end")+"</th>"),C+='</tr></thead><tbody class="yui-dt-data">';for(var R=0;R<y.length;R++){y[R].getGroup()?vRowType="group":vRowType="row",J=y[R].getID();var H=y[R].getLineColor()?'style="background-color:'+y[R].getLineColor()+'"':"";C+=0===y[R].getVisible()?'<tr id="child_'+J+'" class="g'+vRowType+' hidden" '+H+" onMouseover=\"g.mouseOver(this,'"+J+"','left','"+vRowType+"')\" onMouseout=\"g.mouseOut(this,'"+J+"','left','"+vRowType+"')\">":'<tr id="child_'+J+'"  class="g'+vRowType+'" '+H+" onMouseover=\"g.mouseOver(this,'"+J+"','left','"+vRowType+"')\" onMouseout=\"g.mouseOut(this,'"+J+"','left','"+vRowType+"')\">",1===c&&(C+='<td class="ggtaskCheckbox"><input type="checkbox" id="taskChecked-'+J+'" name="taskChecked" onclick="g.selectItem(this,\''+J+"');\"  "+(JSGantt.scope.selectedItems[J]?' checked="checked">':">")+"</td>"),C+='  <td class="gname nowrap"><span style="color: #aaaaaa">';for(var A=1;A<y[R].getLevel();A++)C+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";C+="</span>",C+=y[R].getGroup()?1==y[R].getOpen()?'<div id="group_'+J+'" class="gicon ggroup-expanded" onclick="JSGantt.folder(\''+J+"',"+r+");"+r+'.DrawDependencies();"></div>':'<div id="group_'+J+'" class="gicon ggroup-collapsed" onclick="JSGantt.folder(\''+J+"',"+r+");"+r+'.DrawDependencies();"></div>':'<span style="color: #000000; font-weight:bold; font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>',C+='<span class="task-title" > '+y[R].getName()+"</span></td>",1===o&&(C+="  <td class=gname  ><nobr>"+y[R].getResource()+"</nobr></td>"),1===l&&(C+="  <td class=gname  ><nobr>"+y[R].getDuration(s)+"</nobr></td>"),1===u&&(C+="  <td class=gname  ><nobr>"+y[R].getCompStr()+"</nobr></td>"),1===h&&(C+="  <td class=gname  ><nobr>"+JSGantt.formatDateStr(y[R].getStart(),f)+"</nobr></td>"),1===d&&(C+="  <td class=gname  ><nobr>"+JSGantt.formatDateStr(y[R].getEnd(),f)+"</nobr></td>"),C+="</tr>"}for(C+="</td></tr>",C+="</tbody></table></td>",T+=C+"</div>",k='<div class="scroll yui-u" id="rightside"><table style="width: '+I+'px;" cellSpacing="0" cellPadding="0" border="0"><thead><tr class="gheader">',n.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),n.setHours(0),n.setMinutes(0);n.getTime()<=t.getTime();)if(O=n.getFullYear()+"",O=O.substring(0,4),"minute"==s&&(k+='<th class="gdatehead"   colspan="60">',k+=JSGantt.formatDateStr(n,f)+" "+n.getHours()+":00 -"+n.getHours()+":59 </th>",n.setHours(n.getHours()+1)),"hour"==s&&(k+='<th class="gdatehead"   colspan="24">',k+=JSGantt.formatDateStr(n,f)+"</th>",n.setDate(n.getDate()+1)),"day"==s)k+='<th class="gdatehead"   colspan="7"><center>'+n.getDate()+" - ",n.setDate(n.getDate()+6),k+=JSGantt.formatDateStr(n,f)+"</center></th>",n.setDate(n.getDate()+1);else if("week"==s)k+='<th class="gdatehead"  width='+E+"px><center>"+O+"</center></th>",n.setDate(n.getDate()+7);else if("month"==s)for(k+='<th class="gdatehead"  width='+E+"px><center>"+O+"</center></th>",n.setDate(n.getDate()+1);n.getDate()>1;)n.setDate(n.getDate()+1);else if("quarter"==s)for(k+='<th class="gdatehead"   width='+E+"px><center>"+O+"</center></th>",n.setDate(n.getDate()+81);n.getDate()>1;)n.setDate(n.getDate()+1);for(k+='</tr><tr class="gheader">',n.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),a.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),vNumCols=0;n.getTime()<=t.getTime();){var B="ghead",N="";if("minute"==s)0===n.getMinutes()&&(B="ghead current",v=E*vNumCols),N=n.getMinutes(),n.setMinutes(n.getMinutes()+1);else if("hour"==s)0===n.getHours()&&(B="ghead current",v=E*vNumCols),N=n.getHours(),n.setHours(n.getHours()+1);else if("day"==s)n.getDay()%6===0&&(B="gheadwkend"),JSGantt.formatDateStr(p,"shortDate")==JSGantt.formatDateStr(n,"shortDate")&&(B+=" current",v=E*vNumCols),N=n.getDate(),n.setDate(n.getDate()+1);else if("week"==s)a.setDate(a.getDate()+7),p>=n&&a>p&&(B="ghead current",v=E*vNumCols),N=n.getMonth()+1+"/"+n.getDate(),n.setDate(n.getDate()+7);else if("month"==s)for(a.setFullYear(n.getFullYear(),n.getMonth(),w[n.getMonth()]),p>=n&&a>p&&(B="ghead current",v=E*vNumCols),N=b[n.getMonth()].substr(0,3),n.setDate(n.getDate()+1);n.getDate()>1;)n.setDate(n.getDate()+1);else if("quarter"===s)for(a.setDate(a.getDate()+122),0===n.getMonth()||1===n.getMonth()||2===n.getMonth()?a.setFullYear(n.getFullYear(),2,31):3===n.getMonth()||4===n.getMonth()||5===n.getMonth()?a.setFullYear(n.getFullYear(),5,30):6===n.getMonth()||7===n.getMonth()||8===n.getMonth()?a.setFullYear(n.getFullYear(),8,30):(9===n.getMonth()||10===n.getMonth()||11===n.getMonth())&&a.setFullYear(n.getFullYear(),11,31),p>=n&&a>p&&(B="ghead current",v=E*vNumCols),N=JSGantt.msg("jsgantt.quarter").substr(0,3)+". "+G[n.getMonth()],n.setDate(n.getDate()+81);n.getDate()>1;)n.setDate(n.getDate()+1);Y+=this.renderDateHeaderCell(B,E,N),x+=this.renderDateCell(B,E),vNumCols++}for(k+=Y+"</tr>",k+="</thead></table>",R=0;R<y.length;R++){if(n.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),vTaskStart=y[R].getStart(),vTaskEnd=y[R].getEnd(),J=y[R].getID(),D=(y[R].getEnd()-y[R].getStart())/864e5+1,"hour"==s?D=(y[R].getEnd()-y[R].getStart())/6e4+1:"minute"==s&&(D=(y[R].getEnd()-y[R].getStart())/6e4+1),k+=0===y[R].getVisible()?'<div id="childgrid_'+J+'" style="position:relative;" class="hidden" >':'<div id="childgrid_'+J+'" style="position:relative">',"minute"==s?(F=(y[R].getEnd().getTime()-y[R].getStart().getTime())/6e4+1/L,S=Math.ceil((y[R].getStart().getTime()-e.getTime())/6e4)):"hour"==s?(F=(y[R].getEnd().getTime()-y[R].getStart().getTime())/36e5+1/L,S=(y[R].getStart().getTime()-e.getTime())/36e5):(F=(y[R].getEnd().getTime()-y[R].getStart().getTime())/864e5+1/L,S=Math.ceil((y[R].getStart().getTime()-e.getTime())/864e5)),g.getCaptionType())switch(vCaptionStr="",g.getCaptionType()){case"Caption":vCaptionStr=y[R].getCaption();break;case"Resource":vCaptionStr=y[R].getResource();break;case"Duration":vCaptionStr=y[R].getDuration(s);break;case"Complete":vCaptionStr=y[R].getCompStr()}var q="row";y[R].getMile()?q="mile":y[R].getGroup()&&(q="group");var H=y[R].getLineColor()?'style="background-color:'+y[R].getLineColor()+'"':"";if(k+='<div><table style="width: '+I+'px;"><tbody class="yui-dt-data"><tr id="childrow_'+J+'" '+H+' class="g'+q+'" onMouseover="g.mouseOver(this,\''+J+"','right','"+q+"')\" onMouseout=\"g.mouseOut(this,'"+J+"','right','"+q+"')\">"+x+"</tr></tbody></table></div>",y[R].getMile())Y=JSGantt.formatDateStr(vTaskStart,f),k+=this.renderMile(J,S,F,j,E,Y,vCaptionStr,y[R],s);else if(Y=JSGantt.formatDateStr(vTaskStart,f)+" - "+JSGantt.formatDateStr(vTaskEnd,f),y[R].getGroup()){var P=0,V="",X=0,W="";for(P=R+1;P<y.length;P++)!y[P].getGroup()&&y[P].getMile()&&y[P].getParent()==J&&(X="minute"==s?Math.ceil((y[P].getStart().getTime()-e.getTime())/6e4):"hour"==s?(y[P].getStart().getTime()-e.getTime())/36e5:Math.ceil((y[P].getStart().getTime()-e.getTime())/864e5),W=JSGantt.formatDateStr(y[P].getStart(),f),6>j&&(X-=Math.ceil(6/j)),V+='<div style="position:absolute;top:5px; left:'+Math.ceil(X*j+1)+"px; z-index:1; background-color:#"+y[P].getColor()+';" title="'+W+'" class="milestone" >&nbsp;</div>');k+=V+this.renderGroup(J,S,F,j,E,Y,vCaptionStr,y[R],s)}else k+=this.renderTask(J,S,F,j,E,Y,vCaptionStr,y[R],s);k+="</div></div>"}T+=k+"</div></div>",i.innerHTML=T}this.scrollToY(v)}catch(K){alert(K)}},this.renderMile=function(t,e,n,a,r,i,s,o,g){return 6>a&&(e-=Math.ceil(6/a)),'<div id="bardiv_'+t+'" style="position:absolute; top:3px; left:'+Math.ceil(e*a+1)+'px; height: 16px; width:266px; overflow:hidden;">  <div id="taskbar_'+t+'" title="'+i+'"  class="milestone '+(o.getCompVal()<100?"":"completed")+'" style="background-color:#'+o.getColor()+';">&nbsp;</div>'+(null!=s&&s.length>0?'<div class="gcaption" style="top:0px; left:20px">'+s+"</div>":"")},this.renderTask=function(t,e,n,a,r,i,s,o,g){return'<div id="bardiv_'+t+'" style="position:absolute; top:4px; left:'+Math.ceil(e*a-1)+"px; height:18px; width:"+Math.ceil(n*a-1)+'px"><div id="taskbar_'+t+'" title="'+i+'" class="gtask" style="background-color:#'+o.getColor()+"; width:"+Math.ceil(n*a-1)+'px;"  ><div class="gcomplete" style="width:'+o.getCompStr()+';"></div></div>'+(null!=s&&s.length>0?'<div class="gcaption" style="top:-3px; left:'+(Math.ceil(n*a-1)+6)+'px">'+s+"</div>":"")},this.renderGroup=function(t,e,n,a,r,i,s,o,g){return'<div id="bardiv_'+t+'" style="position:absolute; top:8px; left:'+Math.ceil(e*a-1)+"px; height: 7px; width:"+Math.ceil(n*a-1)+'px"><div id="taskbar_'+t+'" title="'+i+'" class="ggtask" style="width:'+Math.ceil(n*a-1)+'px;"><div class="ggcomplete" style="width:'+o.getCompStr()+'" ></div></div>'+(null!=s&&s.length>0?'<div class="gcaption" style="top:-3px; left:'+(Math.ceil(n*a-1)+6)+'px">'+s+"</div>":"")},this.renderDateHeaderCell=function(t,e,n){return'<th class="'+t+'"  ><div style="width: '+e+'px">'+n+"</div></th>"},this.renderDateCell=function(t,e){return'<td class="'+t+'"  ><div style="width: '+e+'px">&nbsp;&nbsp;</div></td>'},this.selectItem=function(t,e){JSGantt.scope.selectedItems[e]=t.checked,YAHOO.Bubbling.fire(JSGantt.scope.scopeId+"selectedItemsChanged")},this.mouseOver=function(t,e,n,a){"right"==n?vcurrDivID="child_"+e:vcurrDivID="childrow_"+e,Dom.addClass(t,"highlight"),Dom.addClass(vcurrDivID,"highlight")},this.mouseOut=function(t,e,n,a){"right"==n?vcurrDivID="child_"+e:vcurrDivID="childrow_"+e,Dom.removeClass(t,"highlight"),Dom.removeClass(vcurrDivID,"highlight")}},JSGantt.processRows=function(t,e,n,a,r){var i=new Date,s=new Date,o=0,g=0,l=t,u=a,h=0,d=0,c=0,m=r;for(h=0;h<t.length;h++)t[h].getParent()==e&&(m=r,t[h].setVisible(m),1==m&&0===t[h].getOpen()&&(m=0),t[h].setLevel(u),d++,1===t[h].getGroup()&&JSGantt.processRows(l,t[h].getID(),h,u+1,m),(0===o||t[h].getStart()<i)&&(i=t[h].getStart(),o=1),(0===g||t[h].getEnd()>s)&&(s=t[h].getEnd(),g=1),c+=t[h].getCompVal());n>=0&&!t[n].getMile()&&(t[n].setStart(i),t[n].setEnd(s),t[n].setNumKid(d))},JSGantt.getMinDate=function(t,e){var n,a=new Date;a.setFullYear(t[0].getStart().getFullYear(),t[0].getStart().getMonth(),t[0].getStart().getDate());for(var r=0;r<t.length;r++)n=t[r].getStart(),n.getTime()<a.getTime()&&a.setFullYear(t[r].getStart().getFullYear(),t[r].getStart().getMonth(),t[r].getStart().getDate());if("minute"==e)a.setHours(0),a.setMinutes(0);else if("hour"==e)a.setHours(0),a.setMinutes(0);else if("day"==e)for(a.setDate(a.getDate()-1);a.getDay()%7>0;)a.setDate(a.getDate()-1);else if("week"==e)for(a.setDate(a.getDate()-7);a.getDay()%7>0;)a.setDate(a.getDate()-1);else if("month"==e)for(;a.getDate()>1;)a.setDate(a.getDate()-1);else"quarter"==e&&(0===a.getMonth()||1===a.getMonth()||2===a.getMonth()?a.setFullYear(a.getFullYear(),0,1):3===a.getMonth()||4===a.getMonth()||5===a.getMonth()?a.setFullYear(a.getFullYear(),3,1):6===a.getMonth()||7===a.getMonth()||8===a.getMonth()?a.setFullYear(a.getFullYear(),6,1):(9===a.getMonth()||10===a.getMonth()||11===a.getMonth())&&a.setFullYear(a.getFullYear(),9,1));return a},JSGantt.getMaxDate=function(t,e){var n=new Date;n.setFullYear(t[0].getEnd().getFullYear(),t[0].getEnd().getMonth(),t[0].getEnd().getDate());for(var a=0;a<t.length;a++)t[a].getEnd().getTime()>n.getTime()&&n.setTime(t[a].getEnd().getTime());if("minute"==e&&(n.setHours(n.getHours()+1),n.setMinutes(59)),"hour"==e&&n.setHours(n.getHours()+2),"day"==e)for(n.setDate(n.getDate()+1);n.getDay()%6>0;)n.setDate(n.getDate()+1);if("week"==e)for(n.setDate(n.getDate()+11);n.getDay()%6>0;)n.setDate(n.getDate()+1);if("month"==e){for(;n.getDay()>1;)n.setDate(n.getDate()+1);n.setDate(n.getDate()-1)}return"quarter"==e&&(0===n.getMonth()||1===n.getMonth()||2===n.getMonth()?n.setFullYear(n.getFullYear(),2,31):3===n.getMonth()||4===n.getMonth()||5===n.getMonth()?n.setFullYear(n.getFullYear(),5,30):6===n.getMonth()||7===n.getMonth()||8===n.getMonth()?n.setFullYear(n.getFullYear(),8,30):(9===n.getMonth()||10===n.getMonth()||11===n.getMonth())&&n.setFullYear(n.getFullYear(),11,31)),n},JSGantt.changeFormat=function(t,e){e?(e.setFormat(t),e.DrawDependencies()):alert("Chart undefined")},JSGantt.folder=function(t,e){for(var n=e.getList(),a=0;a<n.length;a++)n[a].getID()==t&&(1==n[a].getOpen()?(n[a].setOpen(0),JSGantt.toogleDiv(t,e,0),Dom.removeClass("group_"+t,"ggroup-expanded"),Dom.addClass("group_"+t,"ggroup-collapsed")):(n[a].setOpen(1),JSGantt.toogleDiv(t,e,1),Dom.removeClass("group_"+t,"ggroup-collapsed"),Dom.addClass("group_"+t,"ggroup-expanded")))},JSGantt.toogleDiv=function(t,e,n){for(var a=e.getList(),r=0,i=0;i<a.length;i++)a[i].getParent()==t&&(r=a[i].getID(),0==n?(Dom.addClass("child_"+r,"hidden"),Dom.addClass("childgrid_"+r,"hidden")):(Dom.removeClass("child_"+r,"hidden"),Dom.removeClass("childgrid_"+r,"hidden")),a[i].setVisible(n),1==a[i].getGroup()&&JSGantt.toogleDiv(r,e,n))},JSGantt.parseDateStr=function(t,e){if(null===t||t.length<1)return new Date;if(t instanceof Date)return t;var n=Alfresco.util.fromISO8601(t);return null===n?new Date:n},JSGantt.formatDateStr=function(t,e){return Alfresco.util.formatDate(t,e)}}();