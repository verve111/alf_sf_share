!function(){var a=YAHOO.util.Dom,b=YAHOO.Bubbling;beCPG.module.EntityDataGridActions={},beCPG.module.EntityDataGridActions.prototype={onActionCreate:function(c,d){var e=null!=this.datalistMeta.nodeRef?this.datalistMeta.nodeRef:this.options.parentNodeRef,f=null!=this.options.itemType?this.options.itemType:this.datalistMeta.itemType,g=this,h=function(c,d){Alfresco.util.populateHTML([d.id+"-dialogTitle",this.msg("label.new-row.title")],[d.id+"-dialogHeader",this.msg("label.new-row.header")]),a.get(d.id+"-form-bulkAction")&&(a.get(d.id+"-form-bulkAction").checked=this.onActionCreateBulkEdit,a.get(d.id+"-form-bulkAction-msg").innerHTML=this.msg("button.bulk-action-create")),"34em"!=this.options.formWidth&&a.addClass(d.id+"-dialog","large-dialog")},i=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?bulkEdit=true&entityNodeRef={entityNodeRef}&itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&showCancelButton=true&dataListsName={dataListsName}",{itemKind:"type",itemId:f,destination:e,mode:"create",submitType:"json",entityNodeRef:this.options.entityNodeRef,dataListsName:encodeURIComponent(null!=this.datalistMeta.name?this.datalistMeta.name:this.options.list)}),j=new Alfresco.module.SimpleDialog(this.id+"-createRow");j.bulkEdit=!1,j.setOptions({width:this.options.formWidth,templateUrl:i,actionUrl:null,destroyOnHide:!0,doBeforeDialogShow:{fn:h,scope:this},doBeforeFormSubmit:{fn:function(){var b=a.get(this.id+"-createRow-form-bulkAction");b&&b.checked?g.onActionCreateBulkEdit=!0:g.onActionCreateBulkEdit=!1},scope:this},onSuccess:{fn:function(b){YAHOO.Bubbling.fire(g.scopeId+"dataItemCreated",{nodeRef:b.json.persistedObject,callback:function(a){Alfresco.util.PopupManager.displayMessage({text:g.msg("message.new-row.success")}),g.onActionCreateBulkEdit&&g.onActionCreate()}})},scope:this},onFailure:{fn:function(b){Alfresco.util.PopupManager.displayMessage({text:g.msg("message.new-row.failure")})},scope:this}}).show()},onActionEdit:function(d){var e=this,f=function(c,d){Alfresco.util.populateHTML([d.id+"-dialogTitle",this.msg("label.edit-row.title")]),a.get(d.id+"-form-bulkAction")&&(a.get(d.id+"-form-bulkAction").checked=this.onActionEditBulkEdit,a.get(d.id+"-form-bulkAction-msg").innerHTML=this.msg("button.bulk-action-edit")),"34em"!=this.options.formWidth&&a.addClass(d.id+"-dialog","large-dialog")},g=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?bulkEdit=true&entityNodeRef={entityNodeRef}&itemKind={itemKind}&itemId={itemId}&mode={mode}&submitType={submitType}&showCancelButton=true&dataListsName={dataListsName}",{itemKind:"node",itemId:d.nodeRef,mode:"edit",submitType:"json",entityNodeRef:this.options.entityNodeRef,dataListsName:encodeURIComponent(null!=this.datalistMeta.name?this.datalistMeta.name:this.options.list)}),h=new Alfresco.module.SimpleDialog(this.id+"-editDetails");h.bulkEdit=!1,h.setOptions({width:this.options.formWidth,templateUrl:g,actionUrl:null,destroyOnHide:!0,doBeforeDialogShow:{fn:f,scope:this},doBeforeFormSubmit:{fn:function(){var b=a.get(e.id+"-editDetails-form-bulkAction");b&&b.checked?e.onActionEditBulkEdit=!0:e.onActionEditBulkEdit=!1},scope:this},onSuccess:{fn:function(c){b.fire(e.scopeId+"dataItemUpdated",{nodeRef:c.json.persistedObject,callback:function(a){if(Alfresco.util.PopupManager.displayMessage({text:e.msg("message.details.success")}),e.onActionEditBulkEdit){var b=e._findNextItemByParameter(c.json.persistedObject,"nodeRef");null!=b&&e.onActionEdit(b)}}})},scope:this},onFailure:{fn:function(b){Alfresco.util.PopupManager.displayMessage({text:e.msg("message.details.failure")})},scope:this}}).show()},onActionUp:function(b){b instanceof MouseEvent&&(b=this.getSelectedItems());var c=this;if(c.options.sortable){var d=YAHOO.lang.isArray(b)?b:[b];if(d.length>0){var e=c._findPrevItemByParameter(d[0].nodeRef,"nodeRef");null!=e&&c._sort(d,e,"up")}}},onActionDown:function(b){b instanceof MouseEvent&&(b=this.getSelectedItems());var c=this;if(c.options.sortable){var d=YAHOO.lang.isArray(b)?b:[b];if(d.length>0){var e=c._findNextItemByParameter(d[d.length-1].nodeRef,"nodeRef");null!=e&&c._sort(d,e,"down")}}},_sort:function(b,c,d){var e=this,f=[];if(e.options.sortable){for(var g=0,h=b.length;g<h;g++)f.push(b[g].nodeRef);var i=e.options.sortUrl+"/"+c.nodeRef.replace(":/","")+"?selectedNodeRefs="+f.join(",")+"&dir="+d;Alfresco.util.Ajax.jsonPost({url:i,successCallback:{fn:function(b){e._updateDataGrid.call(e,{page:e.currentPage})},scope:this},failureCallback:{fn:function(b){Alfresco.util.PopupManager.displayMessage({text:e.msg("message.details.failure")})},scope:this}})}},_addSortDnD:function(){var a=this,b="group-"+a.id;if(a.options.sortable){YAHOO.util.DragDropMgr.refreshCache();var c,d,e=a.widgets.dataTable.getTbodyEl().rows;for(c=0;c<e.length;c++)d=e[c].id,a.widgets.dataTable.dtdTargets[d]&&(a.widgets.dataTable.dtdTargets[d].unreg(),delete a.widgets.dataTable.dtdTargets[d]),a.widgets.dataTable.dtdTargets[d]=new YAHOO.util.DDTarget(d,b)}},onActionDelete:function(b){var c=this,d=YAHOO.lang.isArray(b)?b:[b],e=function(b){for(var c=[],d=0,e=b.length;d<e;d++)c.push(b[d].nodeRef);this.modules.actions.genericAction({success:{event:{name:this.scopeId+"dataItemsDeleted",obj:{items:b}},message:this.msg("message.delete.success",b.length)},failure:{message:this.msg("message.delete.failure")},webscript:{method:Alfresco.util.Ajax.DELETE,name:"items"},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:c}}})};Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.confirm.delete.title",d.length),text:this.msg("message.confirm.delete.description",d.length),buttons:[{text:this.msg("button.delete"),handler:function(){this.destroy(),e.call(c,d)}},{text:this.msg("button.cancel"),handler:function(){this.destroy()},isDefault:!0}]})},onActionDuplicate:function(b){for(var c=YAHOO.lang.isArray(b)?b:[b],d=null!=this.modules.dataGrid.datalistMeta.nodeRef?new Alfresco.util.NodeRef(this.modules.dataGrid.datalistMeta.nodeRef):new Alfresco.util.NodeRef(this.modules.dataGrid.options.parentNodeRef),e=[],f=0,g=c.length;f<g;f++)e.push(c[f].nodeRef);this.modules.actions.genericAction({success:{event:{name:this.scopeId+"dataItemsDuplicated",obj:{items:c}},message:this.msg("message.duplicate.success",c.length)},failure:{message:this.msg("message.duplicate.failure")},webscript:{method:Alfresco.util.Ajax.POST,name:"duplicate/node/"+d.uri},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:e}}})}}}();