(function(){var d=YAHOO.util.Dom,b=YAHOO.Bubbling;beCPG.module.EntityDataGridActions={};beCPG.module.EntityDataGridActions.prototype={onActionCreate:function f(n,q){var p=this.datalistMeta.nodeRef!=null?this.datalistMeta.nodeRef:this.options.parentNodeRef,m=this.options.itemType!=null?this.options.itemType:this.datalistMeta.itemType,o=this;var r=function t(u,v){Alfresco.util.populateHTML([v.id+"-dialogTitle",this.msg("label.new-row.title")],[v.id+"-dialogHeader",this.msg("label.new-row.header")]);if(d.get(v.id+"-form-bulkAction")){d.get(v.id+"-form-bulkAction").checked=this.onActionCreateBulkEdit;d.get(v.id+"-form-bulkAction-msg").innerHTML=this.msg("button.bulk-action-create")}if(this.options.formWidth!="34em"){d.addClass(v.id+"-dialog","large-dialog")}};var j=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?bulkEdit=true&entityNodeRef={entityNodeRef}&itemKind={itemKind}&itemId={itemId}&destination={destination}&mode={mode}&submitType={submitType}&showCancelButton=true&dataListsName={dataListsName}",{itemKind:"type",itemId:m,destination:p,mode:"create",submitType:"json",entityNodeRef:this.options.entityNodeRef,dataListsName:encodeURIComponent(this.datalistMeta.name!=null?this.datalistMeta.name:this.options.list)});var l=new Alfresco.module.SimpleDialog(this.id+"-createRow");l.bulkEdit=false;l.setOptions({width:this.options.formWidth,templateUrl:j,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:r,scope:this},doBeforeFormSubmit:{fn:function(){var u=d.get(this.id+"-createRow-form-bulkAction");if(u&&u.checked){o.onActionCreateBulkEdit=true}else{o.onActionCreateBulkEdit=false}},scope:this},onSuccess:{fn:function s(u){YAHOO.Bubbling.fire(o.scopeId+"dataItemCreated",{nodeRef:u.json.persistedObject,callback:function(v){Alfresco.util.PopupManager.displayMessage({text:o.msg("message.new-row.success")});if(o.onActionCreateBulkEdit){o.onActionCreate()}}})},scope:this},onFailure:{fn:function k(u){Alfresco.util.PopupManager.displayMessage({text:o.msg("message.new-row.failure")})},scope:this}}).show()},onActionEdit:function g(n){var m=this;var k=function l(r,s){Alfresco.util.populateHTML([s.id+"-dialogTitle",this.msg("label.edit-row.title")]);if(d.get(s.id+"-form-bulkAction")){d.get(s.id+"-form-bulkAction").checked=this.onActionEditBulkEdit;d.get(s.id+"-form-bulkAction-msg").innerHTML=this.msg("button.bulk-action-edit")}if(this.options.formWidth!="34em"){d.addClass(s.id+"-dialog","large-dialog")}};var p=YAHOO.lang.substitute(Alfresco.constants.URL_SERVICECONTEXT+"components/form?bulkEdit=true&entityNodeRef={entityNodeRef}&itemKind={itemKind}&itemId={itemId}&mode={mode}&submitType={submitType}&showCancelButton=true&dataListsName={dataListsName}",{itemKind:"node",itemId:n.nodeRef,mode:"edit",submitType:"json",entityNodeRef:this.options.entityNodeRef,dataListsName:encodeURIComponent(this.datalistMeta.name!=null?this.datalistMeta.name:this.options.list)});var o=new Alfresco.module.SimpleDialog(this.id+"-editDetails");o.bulkEdit=false;o.setOptions({width:this.options.formWidth,templateUrl:p,actionUrl:null,destroyOnHide:true,doBeforeDialogShow:{fn:k,scope:this},doBeforeFormSubmit:{fn:function(){var r=d.get(m.id+"-editDetails-form-bulkAction");if(r&&r.checked){m.onActionEditBulkEdit=true}else{m.onActionEditBulkEdit=false}},scope:this},onSuccess:{fn:function q(r){b.fire(m.scopeId+"dataItemUpdated",{nodeRef:r.json.persistedObject,callback:function(t){Alfresco.util.PopupManager.displayMessage({text:m.msg("message.details.success")});if(m.onActionEditBulkEdit){var s=m._findNextItemByParameter(r.json.persistedObject,"nodeRef");if(s!=null){m.onActionEdit(s)}}}})},scope:this},onFailure:{fn:function j(r){Alfresco.util.PopupManager.displayMessage({text:m.msg("message.details.failure")})},scope:this}}).show()},onActionUp:function e(k){var m=this;if(m.options.sortable){var j=YAHOO.lang.isArray(k)?k:[k];if(j.length>0){var l=m._findPrevItemByParameter(j[0].nodeRef,"nodeRef");if(l!=null){m._sort(j,l,"up")}}}},onActionDown:function h(k){var m=this;if(m.options.sortable){var j=YAHOO.lang.isArray(k)?k:[k];if(j.length>0){var l=m._findNextItemByParameter(j[j.length-1].nodeRef,"nodeRef");if(l!=null){m._sort(j,l,"down")}}}},_sort:function i(q,l,m){var r=this,n=[];if(r.options.sortable){for(var o=0,s=q.length;o<s;o++){n.push(q[o].nodeRef)}var j=r.options.sortUrl+"/"+l.nodeRef.replace(":/","")+"?selectedNodeRefs="+n.join(",")+"&dir="+m;Alfresco.util.Ajax.jsonPost({url:j,successCallback:{fn:function k(t){r._updateDataGrid.call(r,{page:r.currentPage})},scope:this},failureCallback:{fn:function p(t){Alfresco.util.PopupManager.displayMessage({text:r.msg("message.details.failure")})},scope:this}})}},_addSortDnD:function(){var m=this;var j="group-"+m.id;if(m.options.sortable){YAHOO.util.DragDropMgr.refreshCache();var k,n,l=m.widgets.dataTable.getTbodyEl().rows;for(k=0;k<l.length;k++){n=l[k].id;if(m.widgets.dataTable.dtdTargets[n]){m.widgets.dataTable.dtdTargets[n].unreg();delete m.widgets.dataTable.dtdTargets[n]}m.widgets.dataTable.dtdTargets[n]=new YAHOO.util.DDTarget(n,j)}}},onActionDelete:function a(m){var n=this,k=YAHOO.lang.isArray(m)?m:[m];var l=function o(q){var t=[];for(var r=0,s=q.length;r<s;r++){t.push(q[r].nodeRef)}this.modules.actions.genericAction({success:{event:{name:this.scopeId+"dataItemsDeleted",obj:{items:q}},message:this.msg("message.delete.success",q.length)},failure:{message:this.msg("message.delete.failure")},webscript:{method:Alfresco.util.Ajax.DELETE,name:"items"},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:t}}})};Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.confirm.delete.title",k.length),text:this.msg("message.confirm.delete.description",k.length),buttons:[{text:this.msg("button.delete"),handler:function j(){this.destroy();l.call(n,k)}},{text:this.msg("button.cancel"),handler:function p(){this.destroy()},isDefault:true}]})},onActionDuplicate:function c(n){var k=YAHOO.lang.isArray(n)?n:[n],j=this.modules.dataGrid.datalistMeta.nodeRef!=null?new Alfresco.util.NodeRef(this.modules.dataGrid.datalistMeta.nodeRef):new Alfresco.util.NodeRef(this.modules.dataGrid.options.parentNodeRef),o=[];for(var l=0,m=k.length;l<m;l++){o.push(k[l].nodeRef)}this.modules.actions.genericAction({success:{event:{name:this.scopeId+"dataItemsDuplicated",obj:{items:k}},message:this.msg("message.duplicate.success",k.length)},failure:{message:this.msg("message.duplicate.failure")},webscript:{method:Alfresco.util.Ajax.POST,name:"duplicate/node/"+j.uri},config:{requestContentType:Alfresco.util.Ajax.JSON,dataObj:{nodeRefs:o}}})}}})();